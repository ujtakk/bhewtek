module top(/*AUTOARG*/);
`include "parameters.vh"
<%- load "parameters.rb" -%>
 /*AUTO_LISP(setq verilog-auto-output-ignore-regexp
                (verilog-regexp-words `(
        "mem_input_addr"
        <%- for i in 0...$core -%>
        "mem_weight_addr<%=i%>"
        <%- end -%>
        )))*/

    /*AUTOINPUT*/
    input [INSIZE-1:0] input_addr;
    input [WSIZE-1:0] weight_addr;

    /*AUTOOUTPUT*/

    /*AUTOWIRE*/

    /*AUTOREG*/

    // AUTO_CONSTANT (DWIDTH)

    /* sram_input AUTO_TEMPLATE (
        .read_data  (read_input[DWIDTH-1:0]),
        .write_data (write_input[DWIDTH-1:0]),
        .mem_we     (mem_input_we),
        .mem_addr   (input_addr[INSIZE-1:0] + mem_input_addr[INSIZE-1:0]),
    ); */
    sram_input mem_input(/*AUTOINST*/);

    <%- for i in 0...$core -%>
    /* sram_weight AUTO_TEMPLATE (
        .read_data  (read_weight<%=i%>[DWIDTH-1:0]),
        .write_data (write_weight[DWIDTH-1:0]),
        .mem_we     (mem_weight_we<%=i%>),
        .mem_addr   (weight_addr[WSIZE-1:0] + mem_weight_addr<%=i%>[WSIZE-1:0]),
    ); */
    sram_weight mem_weight<%=i%>(/*AUTOINST*/);
    <%- end -%>

    /* linebuf_pix AUTO_TEMPLATE (
        .read_data (read_input[DWIDTH-1:0]),
    ); */
    linebuf_pix buf_pix(/*AUTOINST*/);

    /* ctrl AUTO_TEMPLATE (
        .fil_h (fil_size[LWIDTH-1:0]),
        .fil_w (fil_size[LWIDTH-1:0]),
        .img_h (img_size[LWIDTH-1:0]),
        .img_w (img_size[LWIDTH-1:0]),
    ); */
    ctrl ctrl(/*AUTOINST*/);

    <%- for i in 0...$core -%>
    /* core AUTO_TEMPLATE (
        .conv_we          (conv_we<%=i%>),
        .mem_feat_addr    (mem_feat_addr<%=i%>[FACCUM-1:0]),
        .mem_feat_addr_d1 (mem_feat_addr<%=i%>_d1[FACCUM-1:0]),
        .mem_feat_rst     (mem_feat_rst<%=i%>),
        .mem_feat_we      (mem_feat_we<%=i%>),
        .pool_we          (pool_we<%=i%>),
        .read_weight      (read_weight<%=i%>[DWIDTH-1:0]),
        .wreg_we          (wreg_we<%=i%>),
        .pmap             (pmap<%=i%>[DWIDTH-1:0]),
    ); */
    core core<%=i%>(/*AUTOINST*/);
    <%- end -%>

    <%- for i in 0...$core -%>
    /* sram_output AUTO_TEMPLATE (
        .read_data  (read_output<%=i%>[DWIDTH-1:0]),
        .write_data (pmap<%=i%>[DWIDTH-1:0]),
        .mem_we     (mem_output_we<%=i%>),
        .mem_addr   (mem_output_addr<%=i%>[OUTSIZE-1:0]),
    ); */
    sram_output mem_output<%=i%>(/*AUTOINST*/);
    <%- end -%>

endmodule
/*
    Local Variables:
    verilog-auto-output-ignore-regexp: t
    eval:(setq verilog-auto-output-ignore-regexp (concat
    "mem_input_addr"
    )))
    End:
*/

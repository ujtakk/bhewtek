module top(/*AUTOARG*/);
`include "parameters.vh"
<%- load "parameters.rb" -%>

    /*AUTOINPUT*/

    /*AUTOOUTPUT*/

    /*AUTOWIRE*/

    /*AUTOREG*/

    // AUTO_CONSTANT (DWIDTH)

    /* sram_input AUTO_TEMPLATE (
        .read_data  (read_input[DWIDTH-1:0]),
        .write_data (write_input[DWIDTH-1:0]),
        .mem_we     (input_we),
        .mem_addr   (mem_input_addr[INSIZE-1:0]),
    ); */
    sram_input mem_input(/*AUTOINST*/);

    /* decoder AUTO_TEMPLATE (
        .in_code (weight_we[3:0]),
        .out_code (mem_weight_we[7:0]),
    ); */
    decoder dec_weight(/*AUTOINST*/);

    <%- for i in 0...$core -%>
    /* sram_weight AUTO_TEMPLATE (
        .read_data  (read_weight<%=i%>[DWIDTH-1:0]),
        .write_data (write_weight[DWIDTH-1:0]),
        .mem_we     (mem_weight_we[<%=i%>]),
        .mem_addr   (mem_weight_addr[WSIZE-1:0]),
    ); */
    sram_weight mem_weight<%=i%>(/*AUTOINST*/);
    <%- end -%>

    /* linebuf_pix AUTO_TEMPLATE (
        .read_data (read_input[DWIDTH-1:0]),
    ); */
    linebuf_pix buf_pix(/*AUTOINST*/);

    /* ctrl AUTO_TEMPLATE (
        .fil_h (fil_size[LWIDTH-1:0]),
        .fil_w (fil_size[LWIDTH-1:0]),
        .img_h (img_size[LWIDTH-1:0]),
        .img_w (img_size[LWIDTH-1:0]),
    ); */
    ctrl ctrl(/*AUTOINST*/);

    <%- for i in 0...$core -%>
    /* core AUTO_TEMPLATE (
        .conv_we          (conv_we),
        .mem_feat_addr    (mem_feat_addr[FACCUM-1:0]),
        .mem_feat_addr_d1 (mem_feat_addr_d1[FACCUM-1:0]),
        .mem_feat_rst     (mem_feat_rst),
        .mem_feat_we      (mem_feat_we),
        .pool_we          (pool_we),
        .read_weight      (read_weight<%=i%>[DWIDTH-1:0]),
        .wreg_we          (wreg_we),
        .pmap             (pmap<%=i%>[DWIDTH-1:0]),
    ); */
    core core<%=i%>(/*AUTOINST*/);
    <%- end -%>

    <%- for i in 0...$core -%>
    /* sram_output AUTO_TEMPLATE (
        .read_data  (read_output<%=i%>[DWIDTH-1:0]),
        .write_data (pmap<%=i%>[DWIDTH-1:0]),
        .mem_we     (mem_output_we),
        .mem_addr   (mem_output_addr[OUTSIZE-1:0]),
    ); */
    (* dont_touch = "true" *) sram_output mem_output<%=i%>(/*AUTOINST*/);
    <%- end -%>

    mux_output select_out(/*AUTOINST*/);
endmodule

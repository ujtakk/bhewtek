`timescale 1ns/1ps

module test_conv_tree();
`include "parameters.vh"
<%- load "parameters.rb" -%>

    /*AUTOREGINPUT*/

    /*AUTOWIRE*/

    //clock
    always
    begin
        clk = 0;
        #(STEP/2);
        clk = 1;
        #(STEP/2);
    end

    integer fp;
    initial
    begin
        fp = $fopen("newtest");
        #(STEP);
        xrst=0;
        <%- for i in 0...$fsize**2 -%>
        pixel<%=i%> = 0;
        weight<%=i%> = 0;
        <%- end -%>
        #(STEP);
        xrst = 1;
        #(STEP);
        <%- for i in 0...$fsize**2 -%>
        pixel<%=i%> = <%=i%>;
        weight<%=i%> = <%=i%>;
        <%- end -%>
        #(STEP*10);
        $finish();
    end

    always
    begin
        #(STEP/2-1);
        <%- for i in 0...5 -%>
        $display(
            <%-   for j in 0...4 -%>
            "%d ", pixel<%=5*i+j%>,
            <%- end -%>
            "%d | ", pixel<%=5*i+4%>,
            <%-   for j in 0...4 -%>
            "%d ", weight<%=5*i+j%>,
            <%- end -%>
            "%d ", weight<%=5*i+4%>
        );
        <%- end -%>
        $display("output: %d\n", fmap);
        $fdisplay(fp,
            "%d ", dut0.xrst,
            "%d ", pixel2,
            "%d ", weight2,
            //"%d ", dut0.r_pixel2,
            //"%d ", dut0.r_weight2,
            "%d ", dut0.sum0,
            "%d ", dut0.sum2,
            "%d ", dut0.sum5,
            "%d ", dut0.sum20,
            //"%d ", dut0.r_fmap,
            "%d ", dut0.fmap,
        );
        #(STEP/2+1);
    end

    conv_tree dut0(/*AUTOINST*/);

endmodule
